(()=>{"use strict";var e={156:e=>{var t=function(e){var t;return!!e&&"object"==typeof e&&"[object RegExp]"!==(t=Object.prototype.toString.call(e))&&"[object Date]"!==t&&e.$$typeof!==i},i="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function s(e,t){return!1!==t.clone&&t.isMergeableObject(e)?a(Array.isArray(e)?[]:{},e,t):e}function n(e,t,i){return e.concat(t).map(function(e){return s(e,i)})}function r(e){return Object.keys(e).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter(function(t){return Object.propertyIsEnumerable.call(e,t)}):[])}function o(e,t){try{return t in e}catch(e){return!1}}function a(e,i,l){(l=l||{}).arrayMerge=l.arrayMerge||n,l.isMergeableObject=l.isMergeableObject||t,l.cloneUnlessOtherwiseSpecified=s;var d,c,u=Array.isArray(i);return u!==Array.isArray(e)?s(i,l):u?l.arrayMerge(e,i,l):(c={},(d=l).isMergeableObject(e)&&r(e).forEach(function(t){c[t]=s(e[t],d)}),r(i).forEach(function(t){(!o(e,t)||Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))&&(o(e,t)&&d.isMergeableObject(i[t])?c[t]=(function(e,t){if(!t.customMerge)return a;var i=t.customMerge(e);return"function"==typeof i?i:a})(t,d)(e[t],i[t],d):c[t]=s(i[t],d))}),c)}a.all=function(e,t){if(!Array.isArray(e))throw Error("first argument should be an array");return e.reduce(function(e,i){return a(e,i,t)},{})},e.exports=a}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var s=i(156),n=i.n(s);class r{static ucFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}static lcFirst(e){return e.charAt(0).toLowerCase()+e.slice(1)}static toDashCase(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(e,t){let i=r.toUpperCamelCase(e,t);return r.lcFirst(i)}static toUpperCamelCase(e,t){return t?e.split(t).map(e=>r.ucFirst(e.toLowerCase())).join(""):r.ucFirst(e.toLowerCase())}static parsePrimitive(e){try{return/^\d+(.|,)\d+$/.test(e)&&(e=e.replace(",",".")),JSON.parse(e)}catch(t){return e.toString()}}}class o{constructor(e=document){this._el=e,e.$emitter=this,this._listeners=[]}publish(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=new CustomEvent(e,{detail:t,cancelable:i});return this.el.dispatchEvent(s),s}subscribe(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=this,n=e.split("."),r=i.scope?t.bind(i.scope):t;if(i.once&&!0===i.once){let t=r;r=function(i){s.unsubscribe(e),t(i)}}return this.el.addEventListener(n[0],r),this.listeners.push({splitEventName:n,opts:i,cb:r}),!0}unsubscribe(e){let t=e.split(".");return this.listeners=this.listeners.reduce((e,i)=>([...i.splitEventName].sort().toString()===t.sort().toString()?this.el.removeEventListener(i.splitEventName[0],i.cb):e.push(i),e),[]),!0}reset(){return this.listeners.forEach(e=>{this.el.removeEventListener(e.splitEventName[0],e.cb)}),this.listeners=[],!0}get el(){return this._el}set el(e){this._el=e}get listeners(){return this._listeners}set listeners(e){this._listeners=e}}class a{constructor(e,t={},i=!1){if(!(e instanceof Node))throw Error("There is no valid element given.");this.el=e,this.$emitter=new o(this.el),this._pluginName=this._getPluginName(i),this.options=this._mergeOptions(t),this._initialized=!1,this._registerInstance(),this._init()}init(){throw Error(`The "init" method for the plugin "${this._pluginName}" is not defined.`)}update(){}_init(){this._initialized||(this.init(),this._initialized=!0)}_update(){this._initialized&&this.update()}_mergeOptions(e){let t=[this.constructor.options,this.options,e];return t.push(this._getConfigFromDataAttribute()),t.push(this._getOptionsFromDataAttribute()),n().all(t.filter(e=>e instanceof Object&&!(e instanceof Array)).map(e=>e||{}))}_getConfigFromDataAttribute(){let e={};if("function"!=typeof this.el.getAttribute)return e;let t=r.toDashCase(this._pluginName),i=this.el.getAttribute(`data-${t}-config`);return i?window.PluginConfigManager.get(this._pluginName,i):e}_getOptionsFromDataAttribute(){let e={};if("function"!=typeof this.el.getAttribute)return e;let t=r.toDashCase(this._pluginName),i=this.el.getAttribute(`data-${t}-options`);if(i)try{return JSON.parse(i)}catch(e){console.error(`The data attribute "data-${t}-options" could not be parsed to json: ${e.message}`)}return e}_registerInstance(){window.PluginManager.getPluginInstancesFromElement(this.el).set(this._pluginName,this),window.PluginManager.getPlugin(this._pluginName,!1).get("instances").push(this)}_getPluginName(e){return e||(e=this.constructor.name),e}}class l{static isNode(e){return"object"==typeof e&&null!==e&&(e===document||e===window||e instanceof Node)}static hasAttribute(e,t){if(!l.isNode(e))throw Error("The element must be a valid HTML Node!");return"function"==typeof e.hasAttribute&&e.hasAttribute(t)}static getAttribute(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!1===l.hasAttribute(e,t))throw Error(`The required property "${t}" does not exist!`);if("function"!=typeof e.getAttribute){if(i)throw Error("This node doesn't support the getAttribute function!");return}return e.getAttribute(t)}static getDataAttribute(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=t.replace(/^data(|-)/,""),n=r.toLowerCamelCase(s,"-");if(!l.isNode(e)){if(i)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===e.dataset){if(i)throw Error("This node doesn't support the dataset attribute!");return}let o=e.dataset[n];if(void 0===o){if(i)throw Error(`The required data attribute "${t}" does not exist on ${e}!`);return o}return r.parsePrimitive(o)}static querySelector(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!l.isNode(e))throw Error("The parent node is not a valid HTML Node!");let s=e.querySelector(t)||!1;if(i&&!1===s)throw Error(`The required element "${t}" does not exist in parent node!`);return s}static querySelectorAll(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(i&&!l.isNode(e))throw Error("The parent node is not a valid HTML Node!");let s=e.querySelectorAll(t);if(0===s.length&&(s=!1),i&&!1===s)throw Error(`At least one item of "${t}" must exist in parent node!`);return s}static getFocusableElements(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=`
            input:not([tabindex^="-"]):not([disabled]):not([type="hidden"]),
            select:not([tabindex^="-"]):not([disabled]),
            textarea:not([tabindex^="-"]):not([disabled]),
            button:not([tabindex^="-"]):not([disabled]),
            a[href]:not([tabindex^="-"]):not([disabled]),
            [tabindex]:not([tabindex^="-"]):not([disabled])
        `;return e.querySelectorAll(t)}static getFirstFocusableElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body;return this.getFocusableElements(e)[0]}static getLastFocusableElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=this.getFocusableElements(e);return t[t.length-1]}}class d{constructor(){this._request=null,this._errorHandlingInternal=!1}get(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",s=this._createPreparedRequest("GET",e,i);return this._sendRequest(s,null,t)}post(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(t,s);let n=this._createPreparedRequest("POST",e,s);return this._sendRequest(n,t,i)}delete(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(t,s);let n=this._createPreparedRequest("DELETE",e,s);return this._sendRequest(n,t,i)}patch(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(t,s);let n=this._createPreparedRequest("PATCH",e,s);return this._sendRequest(n,t,i)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(e){this._errorHandlingInternal=e}_registerOnLoaded(e,t){t&&(!0===this._errorHandlingInternal?(e.addEventListener("load",()=>{t(e.responseText,e)}),e.addEventListener("abort",()=>{console.warn(`the request to ${e.responseURL} was aborted`)}),e.addEventListener("error",()=>{console.warn(`the request to ${e.responseURL} failed with status ${e.status}`)}),e.addEventListener("timeout",()=>{console.warn(`the request to ${e.responseURL} timed out`)})):e.addEventListener("loadend",()=>{t(e.responseText,e)}))}_sendRequest(e,t,i){return this._registerOnLoaded(e,i),e.send(t),e}_getContentType(e,t){return e instanceof FormData&&(t=!1),t}_createPreparedRequest(e,t,i){return this._request=new XMLHttpRequest,this._request.open(e,t),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),i&&this._request.setRequestHeader("Content-type",i),this._request}}let c="loader",u={BEFORE:"before",INNER:"inner"};class h{constructor(e,t=u.BEFORE){this.parent=e instanceof Element?e:document.body.querySelector(e),this.position=t}create(){if(!this.exists()){if(this.position===u.INNER){this.parent.innerHTML=h.getTemplate();return}this.parent.insertAdjacentHTML(this._getPosition(),h.getTemplate())}}remove(){this.parent.querySelectorAll(`.${c}`).forEach(e=>e.remove())}exists(){return this.parent.querySelectorAll(`.${c}`).length>0}_getPosition(){return this.position===u.BEFORE?"afterbegin":"beforeend"}static getTemplate(){return`<div class="${c}" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>`}static SELECTOR_CLASS(){return c}}class p extends h{constructor(e,t="before"){if(super(e,t),!this._isButtonElement()&&!this._isAnchorElement())throw Error("Parent element is not of type <button> or <a>")}create(){super.create(),this._isButtonElement()?this.parent.disabled=!0:this._isAnchorElement()&&this.parent.classList.add("disabled")}remove(){super.remove(),this._isButtonElement()?this.parent.disabled=!1:this._isAnchorElement()&&this.parent.classList.remove("disabled")}_isButtonElement(){return"button"===this.parent.tagName.toLowerCase()}_isAnchorElement(){return"a"===this.parent.tagName.toLowerCase()}}class m extends a{static #e=this.options={};init(){this.client=new d,this.email=null,this.password=null,this.nextButton=l.querySelector(document,"#nextButton"),this.nextLoadingThingy=new p(this.nextButton),this.nextButton.addEventListener("click",e=>{null===this.email?(this.email=document.querySelector("#email").value,this.nextLoadingThingy.create(),this.client.post(this.options.cidaas+"/users-srv/user/checkexists/"+this.options.requestId,JSON.stringify({email:this.email,requestId:this.options.requestId}),e=>{e?JSON.parse(e).success?this.client.post("/cidaas/exists",JSON.stringify({email:this.email}),e=>{let t=JSON.parse(e);t.exists&&this.client.get("/cidaas/lastlogin/"+t.id,e=>{null!==JSON.parse(e).lastLogin?(document.querySelector("#emailContainer").style.display="none",document.querySelector("#passwordContainer").style.display="block",document.querySelector("#nextButton").textContent="Login",this.nextLoadingThingy.remove(),document.querySelector("#password").focus()):(document.querySelector("#emailContainer").style.display="none",document.querySelector("#onetimePassword").style.display="block",this.nextLoadingThingy.remove(),document.querySelector("#nextButton").style.display="none",document.querySelector("#toOtpLink").setAttribute("href",this.options.cidaas+"/identity/login/initiate?userIdHint="+encodeURI(this.email)+"&requestId="+this.options.requestId+"&type=email"))})}):(document.querySelector("#emailContainer").style.display="none",document.querySelector("#nextButton").style.display="none",this.nextLoadingThingy.remove(),document.querySelector("#complete").style.display="block"):window.location.href="/cidaas/register?userIdHint="+this.email+"&type=email"})):null===this.password&&(this.password=document.querySelector("#password").value,document.querySelector("#loginForm").dispatchEvent(new Event("submit")))})}handleFormResponse(e){}}class g{constructor(e){this.init(e)}init(e){this.client=new d,this.url=e,this.scope="openid offline_access email profile groups",this.cidaasUris={generateRequest:"/authz-srv/authrequest/authz/generate",login:"/login-srv/login",changePassword:"/users-srv/changepassword",logout:"/session/end_session",token:"/token-srv/token",emailAuth:"/identity/login/initiate"}}getRequest(e){return new Promise((t,i)=>{this.checkRequestData(e)||i("invalid object"),this.client.post(this.url+this.cidaasUris.generateRequest,JSON.stringify(e),e=>{t(JSON.parse(e))})})}getScope(){return this.scope}checkRequestData(e){let t=Object.keys(e),i=!0;return["client_id","redirect_uri","response_type","scope","state"].forEach(s=>{(0>t.indexOf(s)||""+e[s].length<1)&&(i=!1)}),i}getEmailAuthUri(e,t){return""+this.url+this.cidaasUris.emailAuth+"?userIdHint="+t+"&requestId="+e+"&type=email"}emailExists(e,t){return new Promise(i=>{this.client.post(this.url+"/users-srv/user/checkexists/"+t,JSON.stringify({email:e,requestId:t}),e=>{try{let t=JSON.parse(e);if(t)return i(t)}catch(e){}return i({exists:!1})})})}changePassword(e,t,i,s){return new Promise((n,r)=>{this.client.post(this.url+"/users-srv/changepassword",JSON.stringify({new_password:t,old_password:e,confirm_password:i,identityId:s}),e=>{try{let t=JSON.parse(e);n(t)}catch(e){r(e)}})})}}let y="element-loader-backdrop";class f extends h{static create(e){e.classList.add("has-element-loader"),f.exists(e)||(f.appendLoader(e),setTimeout(()=>{let t=e.querySelector(`.${y}`);t&&t.classList.add("element-loader-backdrop-open")},1))}static remove(e){e.classList.remove("has-element-loader");let t=e.querySelector(`.${y}`);t&&t.remove()}static exists(e){return e.querySelectorAll(`.${y}`).length>0}static getTemplate(){return`
        <div class="${y}">
            <div class="loader" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        `}static appendLoader(e){e.insertAdjacentHTML("beforeend",f.getTemplate())}}window.PluginManager.register("CidaasLogin",m,"[data-cidaas-login]"),window.PluginManager.register("CidaasInfo",class extends a{init(){this.infoShown=!1,this.emailAuth=!1,this.client=new d,this.cidaas=new g(this.options.cidaasUrl),this.clientId=this.options.clientId,this.nextButton=l.querySelector(document,"#weiterButton"),this.requestId="",this.redirectUrl=this.options.redirectUrl,this.nextLoadingThingy=new p(this.nextButton),document.getElementById("devButton").addEventListener("click",async()=>{let e={client_id:this.clientId,redirect_uri:this.redirectUrl,response_type:"code",scope:this.cidaas.getScope(),nonce:new Date().getTime()};this.cidaas.checkRequestData(e);let t=await this.cidaas.getRequest(e);this.requestId=t.data.requestId}),document.getElementById("infoForm").addEventListener("submit",e=>{e.preventDefault(),this.nextLoadingThingy.create(),this.email=document.getElementById("emailInput").value;let t=this.email.replaceAll("+","%2B");this.infoShown?this.emailAuth?(this.cidaas.getEmailAuthUri(this.requestId,this.email),window.location.href="/cidaas/login?redirect_login=email&email="+t+"&requestId="+this.requestId):(this.infoShown=!1,document.getElementById("emailContainer").style.display="block",document.getElementById("infoContainer").style.display="none",this.nextLoadingThingy.remove()):this.client.post("/cidaas/exists",JSON.stringify({email:this.email}),this.handleExistsData.bind(this))})}async handleExistsData(e){let t=JSON.parse(e),i={client_id:this.clientId,redirect_uri:this.redirectUrl,response_type:"code",scope:this.cidaas.getScope(),nonce:new Date().getTime(),state:this.options.state},s=await this.cidaas.getRequest(i);this.requestId=s.data.requestId;let n=this.email.replaceAll("+","%2B");t.exists?null===t.lastLogin?(this.nextLoadingThingy.remove(),document.getElementById("emailContainer").style.display="none",document.getElementById("buttonContainer").style.display="none",document.getElementById("infoContainer").style.display="block",document.getElementById("notYet").addEventListener("click",e=>{window.location.href=this.options.cidaasUrl+"/identity/password_forgot_init?userIdHint="+n+"&requestId="+this.requestId+"&type=email&redirect_to="+this.redirectUrl}),document.getElementById("already").addEventListener("click",e=>{window.location.href="/cidaas/login?redirect_login=email&email="+n+"&requestId="+this.requestId})):window.location.href="/cidaas/login?redirect_login=email&email="+n+"&requestId="+this.requestId:(await this.cidaas.emailExists(this.email,this.requestId)).success?window.location.href="/cidaas/login?redirect_login=email&email="+n+"&requestId="+this.requestId:window.location.href="/cidaas/register?userIdHint="+n+"&type=email"}},"[data-cidaas-info]"),window.PluginManager.register("CidaasEmailChange",class extends a{init(){console.log("CidaasEmailChange loaded"),this.client=new d,document.getElementById("emailForm").addEventListener("submit",this.handleSubmit.bind(this)),this.mailContainer=l.querySelector(document,"div#accountMailContainer"),this.verifyPopup=document.getElementById("emailVerifyPopup"),this.verifyInput=document.getElementById("verifyCodeInput"),this.verifyButton=document.getElementById("verifySubmitButton"),this.cancelButton=document.getElementById("verifyCancelButton"),this.errorMsg=document.getElementById("verifyErrorMsg"),this.verifyButton&&this.verifyButton.addEventListener("click",this.handleOtpVerify.bind(this)),this.cancelButton&&this.cancelButton.addEventListener("click",this.handleOtpCancel.bind(this))}sleep(e){return new Promise(t=>setTimeout(t,e))}handleSubmit(e){e.preventDefault(),console.log("Form submit JS triggered");let t=document.getElementById("personalMail").value;t===document.getElementById("personalMailConfirmation").value?(document.getElementById("personalMailConfirmation").classList.remove("is-invalid"),document.getElementById("invalidFeedback").style.display="none",this.changeEmail(t)):(document.getElementById("invalidFeedback").style.display="block",document.getElementById("personalMailConfirmation").classList.add("is-invalid"))}async changeEmail(e){this.email=e,document.getElementById("emailForm").style.display="none",document.getElementById("emailVerifySpan").textContent=e,document.getElementById("verifyThing").style.display="block",document.getElementById("verifyButton").addEventListener("click",this.handleVerify.bind(this))}handleVerify(){f.create(this.mailContainer),this.client.post("/cidaas/send/change/email/otp",JSON.stringify({email:this.email}),e=>{f.remove(this.mailContainer);let t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){console.error("Invalid JSON response:",t);return}t.success?this.showVerificationPopup():console.log(e.message||"Failed to send verification code. Try again.")})}showVerificationPopup(){this.verifyInput&&(this.verifyInput.value=""),this.errorMsg&&(this.errorMsg.style.display="none"),this.verifyPopup&&(this.verifyPopup.style.display="flex")}handleOtpVerify(){let e=this.verifyInput.value.trim();if(!e){this.errorMsg.textContent="Code is required!",this.errorMsg.style.display="block";return}this.errorMsg.style.display="none",f.create(this.mailContainer),this.client.post("/cidaas/verify/change/email",JSON.stringify({email:this.email,verificationCode:e}),e=>{console.log("OTP verification response:",e),f.remove(this.mailContainer);let t=e;if("string"==typeof t)try{t=JSON.parse(t)}catch(e){console.error("Invalid JSON response:",t);return}t.success?(this.verifyPopup.style.display="none",this.redirectProfilePath()):(this.errorMsg.textContent=e.message||"Code is incorrect!",this.errorMsg.style.display="block")})}handleOtpCancel(){this.verifyPopup&&(this.verifyPopup.style.display="none"),this.verifyInput&&(this.verifyInput.value=""),this.errorMsg&&(this.errorMsg.style.display="none")}redirectProfilePath(){let e=`${window.location.protocol}//${window.location.host}`,t=window.location.pathname.match(/^\/([a-z]{2})(\/|$)/i),i=t?t[1]:"",s=i?`${e}/${i}/account/profile`:`${e}/account/profile`;window.location.href=s}},"[data-cidaas-email-change]"),window.PluginManager.register("CidaasPassword",class extends a{init(){document.getElementById("profilePasswordForm").addEventListener("submit",this.handleFormSubmit.bind(this)),this.newPasswordInput=document.getElementById("newPassword"),this.confirmPasswordInput=document.getElementById("passwordConfirmation"),this.oldPasswordInput=document.getElementById("password"),this.client=new d,this.client.get("/cidaas/url",e=>{try{let t=JSON.parse(e);this.cidaasUrl=t.url,this.cidaas=new g(t.url)}catch(t){console.log(t,e)}})}async handleFormSubmit(e){e.preventDefault(),this.checkInputFields()&&this.client.post("/cidaas/changepassword",JSON.stringify({newPassword:this.newPasswordInput.value,oldPassword:this.oldPasswordInput.value,confirmPassword:this.confirmPasswordInput.value}),e=>{try{JSON.parse(e).success?this.redirectToUrl("/account/logout"):this.redirectToUrl("/account/profile")}catch(e){console.log(e)}})}sendSuccessInfo(){this.client.post("/cidaas/changepassword",JSON.stringify({result:!0}),e=>{window.location.href="/account"})}redirectToUrl(e){let t=`${window.location.protocol}//${window.location.host}`,i=window.location.pathname.match(/^\/([a-z]{2})(\/|$)/i),s=i?i[1]:"",n=s?`${t}/${s}${e}`:`${t}${e}`;window.location.href=n}checkInputFields(){let e=this.newPasswordInput.value,t=this.oldPasswordInput.value,i=this.confirmPasswordInput.value;return!(e.length<8)&&!(i.length<8)&&!(t.length<1)&&e===i}},"[data-cidaas-password]")})();